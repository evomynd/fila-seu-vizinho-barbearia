<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão - Barbearia Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .glass-panel { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .nav-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; font-weight: 600; }
        
        /* Animação suave para modal */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 300ms, transform 300ms; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navegação de Simulação (Para alternar entre as visões do sistema) -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fa-solid fa-scissors text-blue-600 text-2xl mr-2"></i>
                    <span class="font-bold text-xl text-gray-800">BarberAdmin</span>
                </div>
                <div class="flex space-x-8 items-center">
                    <button onclick="switchView('admin')" id="btn-admin" class="nav-item nav-active py-4 px-2 hover:text-blue-500 transition">
                        <i class="fa-solid fa-chart-pie mr-1"></i> Admin (Dashboard)
                    </button>
                    <button onclick="switchView('barber')" id="btn-barber" class="nav-item py-4 px-2 hover:text-blue-500 transition">
                        <i class="fa-solid fa-user-tie mr-1"></i> Área do Barbeiro
                    </button>
                    <button onclick="switchView('client')" id="btn-client" class="nav-item py-4 px-2 hover:text-blue-500 transition">
                        <i class="fa-solid fa-mobile-screen mr-1"></i> App do Cliente
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="flex-grow p-6">
        
        <!-- ========================================== -->
        <!-- VIEW 1: ADMIN DASHBOARD (CHART JS)        -->
        <!-- ========================================== -->
        <div id="view-admin" class="view-section max-w-7xl mx-auto space-y-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Dashboard de Performance</h2>
                <div class="text-sm text-gray-500 bg-white px-3 py-1 rounded shadow-sm">
                    <i class="fa-regular fa-calendar mr-2"></i> Últimos 7 dias
                </div>
            </div>

            <!-- Grid de Gráficos -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Gráfico 1: Cortes Concluídos -->
                <div class="glass-panel p-4 flex flex-col">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-2">
                        <i class="fa-solid fa-check-circle text-green-500 mr-2"></i>Cortes Concluídos
                    </h3>
                    <div class="relative h-64 w-full">
                        <canvas id="chartCompleted"></canvas>
                    </div>
                    <p class="text-xs text-gray-400 mt-2 text-center">Total de finalizações por barbeiro/dia</p>
                </div>

                <!-- Gráfico 2: Faltas (No-shows) -->
                <div class="glass-panel p-4 flex flex-col">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-2">
                        <i class="fa-solid fa-user-xmark text-red-500 mr-2"></i>Faltas (No-Shows)
                    </h3>
                    <div class="relative h-64 w-full">
                        <canvas id="chartNoShows"></canvas>
                    </div>
                    <p class="text-xs text-gray-400 mt-2 text-center">Clientes que não compareceram</p>
                </div>

                <!-- Gráfico 3: Tempo Médio -->
                <div class="glass-panel p-4 flex flex-col md:col-span-2 lg:col-span-1">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2 border-b pb-2">
                        <i class="fa-solid fa-stopwatch text-blue-500 mr-2"></i>Tempo Médio (min)
                    </h3>
                    <div class="relative h-64 w-full">
                        <canvas id="chartAvgTime"></canvas>
                    </div>
                    <p class="text-xs text-gray-400 mt-2 text-center">Média calculada entre cliques "Finalizar"</p>
                </div>

            </div>

            <!-- Tabela Resumo Rápido -->
            <div class="glass-panel p-6 mt-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Métricas Consolidadas (Hoje)</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left text-sm whitespace-nowrap">
                        <thead class="uppercase tracking-wider border-b-2 border-gray-200 bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-gray-600 font-bold">Barbeiro</th>
                                <th scope="col" class="px-6 py-3 text-gray-600 font-bold">Cortes Hoje</th>
                                <th scope="col" class="px-6 py-3 text-gray-600 font-bold">Faltas</th>
                                <th scope="col" class="px-6 py-3 text-gray-600 font-bold">Tempo Médio</th>
                                <th scope="col" class="px-6 py-3 text-gray-600 font-bold">Status Atual</th>
                            </tr>
                        </thead>
                        <tbody id="admin-summary-table" class="bg-white divide-y divide-gray-100">
                            <!-- Preenchido via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW 2: BARBER INTERFACE (PAUSE BUTTON)   -->
        <!-- ========================================== -->
        <div id="view-barber" class="view-section hidden max-w-md mx-auto">
            <div class="bg-white rounded-xl shadow-xl overflow-hidden">
                <div class="bg-gray-800 p-6 text-white text-center">
                    <div class="w-20 h-20 bg-gray-300 rounded-full mx-auto mb-3 overflow-hidden border-4 border-white">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Avatar" class="w-full h-full object-cover">
                    </div>
                    <h2 class="text-xl font-bold">Olá, João Silva</h2>
                    <p class="text-gray-400 text-sm">Painel de Atendimento</p>
                </div>
                
                <div class="p-6 space-y-4">
                    <!-- Status Display -->
                    <div id="barber-status-display" class="bg-green-100 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-center font-semibold mb-6">
                        <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                        Disponível para Cortes
                    </div>

                    <!-- Action Buttons -->
                    <button onclick="simulateFinishCut()" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow transition transform hover:scale-[1.02] flex items-center justify-center">
                        <i class="fa-solid fa-check-double mr-2"></i> Finalizar Corte Atual
                    </button>

                    <button onclick="openPauseModal()" id="btn-pause-toggle" class="w-full py-4 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-bold shadow transition transform hover:scale-[1.02] flex items-center justify-center">
                        <i class="fa-solid fa-coffee mr-2"></i> Pausar Atendimento
                    </button>
                </div>
                
                <div class="px-6 pb-6 text-center text-xs text-gray-400">
                    <p>Ao clicar em "Finalizar", o tempo é registrado para o cálculo de média.</p>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- VIEW 3: CLIENT APP (STATUS VISIBILITY)    -->
        <!-- ========================================== -->
        <div id="view-client" class="view-section hidden max-w-md mx-auto">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-1">Agendar Horário</h2>
                <p class="text-gray-500 text-sm">Escolha seu profissional preferido.</p>
            </div>

            <div class="space-y-4" id="client-barber-list">
                <!-- Barbeiro 1 (Dinâmico) -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="relative">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-14 h-14 rounded-full bg-gray-100">
                            <!-- Status Dot -->
                            <div id="client-status-dot-0" class="absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="ml-4">
                            <h3 class="font-bold text-gray-800">João Silva</h3>
                            <p class="text-xs text-gray-500">Mestre Barbeiro</p>
                            
                            <!-- Mensagem de Status para o Cliente -->
                            <div id="client-status-text-0" class="mt-1 text-xs font-semibold text-green-600">
                                Disponível
                            </div>
                        </div>
                    </div>
                    <button id="client-btn-0" class="px-4 py-2 bg-gray-900 text-white text-sm rounded-lg hover:bg-black transition">
                        Agendar
                    </button>
                </div>

                <!-- Barbeiro 2 (Estático/Exemplo) -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between opacity-70">
                    <div class="flex items-center">
                        <div class="relative">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka" class="w-14 h-14 rounded-full bg-gray-100">
                            <div class="absolute bottom-0 right-0 w-4 h-4 bg-gray-400 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="ml-4">
                            <h3 class="font-bold text-gray-800">Ana Costa</h3>
                            <p class="text-xs text-gray-500">Barbeira</p>
                            <div class="mt-1 text-xs font-semibold text-gray-500">
                                Folga
                            </div>
                        </div>
                    </div>
                    <button disabled class="px-4 py-2 bg-gray-200 text-gray-400 text-sm rounded-lg cursor-not-allowed">
                        Indisponível
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- MODAL DE PAUSA (BARBEIRO) -->
    <div id="pause-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-100">
            <div class="bg-orange-500 p-4 text-white text-center">
                <h3 class="font-bold text-lg">Motivo da Pausa</h3>
                <p class="text-xs opacity-90">Selecione o motivo para justificar sua ausência.</p>
            </div>
            <div class="p-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Selecione:</label>
                <div class="relative">
                    <select id="pause-reason" class="block w-full pl-3 pr-10 py-3 text-base border-gray-300 bg-gray-50 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md border">
                        <option value="lunch">Almoço</option>
                        <option value="snack">Lanche</option>
                        <option value="bathroom">Banheiro</option>
                        <option value="out">Saída do Salão (Banco/Resol.)</option>
                        <option value="other">Outros</option>
                    </select>
                </div>
                
                <div class="mt-6 flex space-x-3">
                    <button onclick="closePauseModal()" class="flex-1 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium">Cancelar</button>
                    <button onclick="confirmPause()" class="flex-1 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 font-medium shadow-md">Confirmar Pausa</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. CONFIGURAÇÃO DE ESTADO E DADOS ---
        
        // Estado simulado do sistema
        const state = {
            barbers: [
                { id: 0, name: 'João Silva', status: 'active', pauseReason: null, cutsToday: 8, noShows: 1, avgTime: 35 },
                { id: 1, name: 'Marcos Souza', status: 'active', pauseReason: null, cutsToday: 10, noShows: 0, avgTime: 28 },
                { id: 2, name: 'Elias Neto', status: 'active', pauseReason: null, cutsToday: 6, noShows: 2, avgTime: 42 }
            ],
            // Dados históricos para os gráficos
            history: {
                dates: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
                completed: [
                    [5, 8, 7, 9, 12, 15], // João
                    [6, 7, 8, 10, 11, 14], // Marcos
                    [4, 5, 5, 7, 8, 10]   // Elias
                ],
                noShows: [
                    [0, 1, 0, 0, 2, 1], // João
                    [0, 0, 1, 0, 0, 0], // Marcos
                    [1, 0, 1, 1, 0, 1]  // Elias
                ],
                avgTimes: [
                    [35, 34, 36, 33, 35, 32], // João
                    [30, 29, 28, 28, 30, 27], // Marcos
                    [45, 42, 44, 40, 42, 40]  // Elias
                ]
            }
        };

        // --- 2. LÓGICA DE NAVEGAÇÃO ---
        
        function switchView(viewName) {
            // Esconder todas as views
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            
            // Remover classe ativa dos botões
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('nav-active', 'text-blue-600');
                el.classList.add('text-gray-500');
            });

            // Mostrar view selecionada
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            
            // Ativar botão
            const btn = document.getElementById(`btn-${viewName}`);
            btn.classList.add('nav-active', 'text-blue-600');
            btn.classList.remove('text-gray-500');

            // Se for admin, renderizar gráficos (re-renderizar para garantir tamanho correto)
            if(viewName === 'admin') {
                renderCharts();
                updateAdminTable();
            }
            // Se for cliente, atualizar lista
            if(viewName === 'client') {
                updateClientView();
            }
        }

        // --- 3. LÓGICA DO BARBEIRO (PAUSA) ---

        const modal = document.getElementById('pause-modal');
        const statusDisplay = document.getElementById('barber-status-display');
        const pauseBtn = document.getElementById('btn-pause-toggle');
        const selectReason = document.getElementById('pause-reason');

        // Simula o barbeiro João (index 0)
        let currentBarberIndex = 0; 

        function openPauseModal() {
            // Se já estiver pausado, a ação é "Retomar"
            if (state.barbers[currentBarberIndex].status === 'paused') {
                resumeWork();
            } else {
                modal.classList.remove('hidden');
            }
        }

        function closePauseModal() {
            modal.classList.add('hidden');
        }

        function confirmPause() {
            const reason = selectReason.value;
            const reasonText = selectReason.options[selectReason.selectedIndex].text;
            
            // Atualizar Estado
            state.barbers[currentBarberIndex].status = 'paused';
            state.barbers[currentBarberIndex].pauseReason = reasonText;

            // Atualizar UI Barbeiro
            updateBarberUI(true, reasonText);
            
            // Fechar modal
            closePauseModal();
            
            alert(`Pausa iniciada: ${reasonText}. O cliente verá apenas que você está pausado.`);
        }

        function resumeWork() {
            state.barbers[currentBarberIndex].status = 'active';
            state.barbers[currentBarberIndex].pauseReason = null;
            updateBarberUI(false);
        }

        function updateBarberUI(isPaused, reason = "") {
            if (isPaused) {
                statusDisplay.className = "bg-orange-100 border border-orange-200 text-orange-700 px-4 py-3 rounded-lg text-center font-semibold mb-6";
                statusDisplay.innerHTML = `<i class="fa-solid fa-pause mr-2"></i> EM PAUSA (${reason})`;
                
                pauseBtn.innerHTML = `<i class="fa-solid fa-play mr-2"></i> Retomar Atendimento`;
                pauseBtn.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                pauseBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                statusDisplay.className = "bg-green-100 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-center font-semibold mb-6";
                statusDisplay.innerHTML = `<span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2 animate-pulse"></span> Disponível para Cortes`;
                
                pauseBtn.innerHTML = `<i class="fa-solid fa-coffee mr-2"></i> Pausar Atendimento`;
                pauseBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                pauseBtn.classList.add('bg-orange-500', 'hover:bg-orange-600');
            }
        }

        function simulateFinishCut() {
            if (state.barbers[currentBarberIndex].status === 'paused') {
                alert("Você está em pausa! Retome o atendimento para finalizar cortes.");
                return;
            }
            
            // Simulação simples: aumenta a contagem
            state.barbers[currentBarberIndex].cutsToday++;
            // Simula um pequeno ajuste no tempo médio
            const variance = Math.floor(Math.random() * 5) - 2; 
            state.barbers[currentBarberIndex].avgTime += variance;

            alert("Corte finalizado! Dados enviados para o painel Admin.");
            
            // Se estivesse no admin, atualizaria ao trocar de aba.
        }

        // --- 4. LÓGICA DO CLIENTE ---

        function updateClientView() {
            // Focando apenas no barbeiro dinâmico (João) para demonstrar a funcionalidade
            const barber = state.barbers[0]; // João
            
            const dot = document.getElementById('client-status-dot-0');
            const statusText = document.getElementById('client-status-text-0');
            const btn = document.getElementById('client-btn-0');

            if (barber.status === 'paused') {
                // Estado Pausado (Motivo oculto para o cliente)
                dot.className = "absolute bottom-0 right-0 w-4 h-4 bg-orange-500 border-2 border-white rounded-full";
                statusText.innerHTML = `<i class="fa-solid fa-clock text-orange-500 mr-1"></i> Em Pausa (Retorno em breve)`;
                statusText.className = "mt-1 text-xs font-semibold text-orange-600";
                
                btn.disabled = true;
                btn.className = "px-4 py-2 bg-gray-300 text-gray-500 text-sm rounded-lg cursor-not-allowed";
                btn.innerText = "Aguarde";
            } else {
                // Estado Ativo
                dot.className = "absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full";
                statusText.innerHTML = "Disponível";
                statusText.className = "mt-1 text-xs font-semibold text-green-600";
                
                btn.disabled = false;
                btn.className = "px-4 py-2 bg-gray-900 text-white text-sm rounded-lg hover:bg-black transition";
                btn.innerText = "Agendar";
            }
        }

        // --- 5. LÓGICA DO DASHBOARD ADMIN (CHART.JS) ---
        
        let chart1, chart2, chart3;

        function updateAdminTable() {
            const tbody = document.getElementById('admin-summary-table');
            tbody.innerHTML = '';
            
            state.barbers.forEach(b => {
                let statusBadge = '';
                if(b.status === 'active') statusBadge = '<span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full">Trabalhando</span>';
                else statusBadge = `<span class="px-2 py-1 text-xs font-semibold text-orange-800 bg-orange-100 rounded-full">Pausa: ${b.pauseReason}</span>`;

                tbody.innerHTML += `
                    <tr>
                        <td class="px-6 py-4 font-medium text-gray-900">${b.name}</td>
                        <td class="px-6 py-4 text-gray-500">${b.cutsToday}</td>
                        <td class="px-6 py-4 text-gray-500 text-red-500 font-bold">${b.noShows}</td>
                        <td class="px-6 py-4 text-gray-500">${b.avgTime} min</td>
                        <td class="px-6 py-4">${statusBadge}</td>
                    </tr>
                `;
            });
        }

        function renderCharts() {
            const colors = {
                blue: 'rgba(59, 130, 246, 0.7)',
                blueBorder: 'rgb(59, 130, 246)',
                green: 'rgba(16, 185, 129, 0.7)',
                greenBorder: 'rgb(16, 185, 129)',
                purple: 'rgba(139, 92, 246, 0.7)',
                purpleBorder: 'rgb(139, 92, 246)',
                red: 'rgba(239, 68, 68, 0.7)',
            };

            // Destruir gráficos anteriores se existirem para evitar sobreposição ao redimensionar/trocar aba
            if(chart1) chart1.destroy();
            if(chart2) chart2.destroy();
            if(chart3) chart3.destroy();

            // GRÁFICO 1: Cortes Concluídos (Bar Chart Grouped)
            const ctx1 = document.getElementById('chartCompleted').getContext('2d');
            chart1 = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: state.history.dates,
                    datasets: [
                        { label: 'João', data: state.history.completed[0], backgroundColor: colors.blue },
                        { label: 'Marcos', data: state.history.completed[1], backgroundColor: colors.green },
                        { label: 'Elias', data: state.history.completed[2], backgroundColor: colors.purple }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // GRÁFICO 2: Faltas (Bar Chart)
            const ctx2 = document.getElementById('chartNoShows').getContext('2d');
            chart2 = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: state.history.dates,
                    datasets: [
                        { label: 'João', data: state.history.noShows[0], backgroundColor: colors.blue },
                        { label: 'Marcos', data: state.history.noShows[1], backgroundColor: colors.green },
                        { label: 'Elias', data: state.history.noShows[2], backgroundColor: colors.purple }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });

            // GRÁFICO 3: Tempo Médio (Line Chart)
            // Lógica: Média das diferenças entre cliques em finalizar
            const ctx3 = document.getElementById('chartAvgTime').getContext('2d');
            chart3 = new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: state.history.dates,
                    datasets: [
                        { 
                            label: 'João', 
                            data: state.history.avgTimes[0], 
                            borderColor: colors.blueBorder,
                            backgroundColor: colors.blue,
                            tension: 0.3,
                            fill: false
                        },
                        { 
                            label: 'Marcos', 
                            data: state.history.avgTimes[1], 
                            borderColor: colors.greenBorder,
                            backgroundColor: colors.green,
                            tension: 0.3,
                            fill: false
                        },
                        { 
                            label: 'Elias', 
                            data: state.history.avgTimes[2], 
                            borderColor: colors.purpleBorder,
                            backgroundColor: colors.purple,
                            tension: 0.3,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: false, title: { display: true, text: 'Minutos' } } }
                }
            });
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            switchView('admin'); // Inicia no admin
        });

    </script>
</body>
</html>
